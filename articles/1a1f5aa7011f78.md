---
title: "useContext(): åŸºæœ¬æ“ä½œã¨useReducerã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ"
emoji: "ğŸ’"
type: "tech"
topics: ["javascript", "react", "hooks"]
published: true
---

React v16.8.0 ä»¥é™ã§å°å…¥ã•ã‚ŒãŸ useContext ã¯ã€React ã®ãƒ•ãƒƒã‚¯ã®ä¸€ã¤ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼å…¨ä½“ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã®ã‚‚ã®ã€‚useContext ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç›´æ¥åˆ©ç”¨ã§ãã‚‹ãŸã‚ã€æ·±ããƒã‚¹ãƒˆã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚ç°¡å˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã‚‹ã€‚ä»¥ä¸‹ã«ã€useContext ã®å«ã‚ãŸä½œæˆæ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

## 1. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆ
ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã«ã¯ React.createContext ã‚’ä½¿ç”¨ã™ã‚‹ã€‚ä½¿ç”¨ã«ã¯ã€Provider ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ã§ã€value ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é€šã˜ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å€¤ã‚’æ¸¡ã™ã€‚
```tsx:MyContext.js
import React, { createContext, useState } from 'react';

const CounterContext = createContext();

const CounterProvider = ({ children }) => {
  const [count, setCount] = useState(0);

  const increment = () => setCount(count + 1);
  const decrement = () => setCount(count - 1);

  return (
    <CounterContext.Provider value={{ count, increment, decrement }}>
      {children}
    </CounterContext.Provider>
  );
};
// CounterContextã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰åˆ©ç”¨ã™ã‚‹éš›ã€
// useContext ã‚’ä½¿ã£ã¦ã“ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
export { CounterContext, CounterProvider };
```
## 2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æä¾›
ç‰¹å®šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼(ã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³)ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å€¤ã‚„é–¢æ•°ã‚’æ¸¡ã™ãŸã‚ã®è¨­å®šæ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
```tsx:AppEntry.js
import React from 'react';
import ReactDOM from 'react-dom';
import App from './App';
import { CounterProvider } from './CounterContext';

ReactDOM.render(
  <CounterProvider>
    <App />
  </CounterProvider>,
  document.getElementById('root')
);
```
* ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆã¨æä¾›ã®éƒ¨åˆ†ã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚

## 3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ©ç”¨
ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å€¤ã‚„é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€useContext ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ãã®å€¤ã‚„é–¢æ•°ã‚’å–å¾—ã™ã‚‹ã€‚
```tsx:CounterComponent.tsx
import React, { useContext } from 'react';
import { CounterContext } from './CounterContext';

const CounterComponent = () => {
  const { count, increment, decrement } = useContext(CounterContext);

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>Increment</button>
      <button onClick={decrement}>Decrement</button>
    </div>
  );
};

export default CounterComponent;
```

## 4. ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä½œæˆ
useReducer ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ã‚’è¡Œã†ã€‚ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã‚’ä½¿ã†ã“ã¨ã§ã€çŠ¶æ…‹é·ç§»ã‚’ä¸€ã¤ã®é–¢æ•°ï¼ˆãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼é–¢æ•°ï¼‰ã«é›†ç´„ã—ã€çŠ¶æ…‹æ›´æ–°ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚ˆã‚Šæ˜ç¢ºã‹ã¤ç®¡ç†ã—ã‚„ã™ãã™ã‚‹ã€‚

æ‰‹é †
1. åˆæœŸçŠ¶æ…‹ã®å®šç¾©ï¼šçŠ¶æ…‹ã®åˆæœŸå€¤ã‚’è¨­å®šã™ã‚‹ã€‚
2. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®šç¾©ï¼šçŠ¶æ…‹ã‚’ã©ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã‹ã‚’æŒ‡ç¤ºã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã™ã‚‹ã€‚
3. ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼é–¢æ•°ã®ä½œæˆï¼šç¾åœ¨ã®çŠ¶æ…‹ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å—ã‘å–ã‚Šã€æ–°ã—ã„çŠ¶æ…‹ã‚’è¿”ã™é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚
4. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ä½œæˆï¼šcreateContext ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã—ã€useReducer ã‚’ä½¿ã£ã¦çŠ¶æ…‹ç®¡ç†ã‚’è¡Œã†ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

ã“ã®æ–¹æ³•ã«ã‚ˆã‚Šã€çŠ¶æ…‹ã®å¤‰æ›´ãŒæ˜ç¢ºã«å®šç¾©ã•ã‚Œã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ã®çŠ¶æ…‹ç®¡ç†ãŒå®¹æ˜“ã«ãªã‚‹ã€‚ä¾‹ãˆã°ã€è¤‡æ•°ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã§ã‚‚ã€ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼é–¢æ•°å†…ã§ãã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€å…ƒç®¡ç†ã§ãã‚‹ã€‚

useReducer() ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’ã”è¦§ãã ã•ã„ï¼šã€Œ[useReducer(): åŸºæœ¬æ“ä½œã¨å®Ÿè£…ä¾‹](https://zenn.dev/kkoisland/articles/16f008a2a0e7cd)ã€

```tsx:MainEntry.js

import React, { useReducer, useCallback, createContext, useContext } from 'react';

const initialState = {
  isStarted: false,
};

const startAction = {
  type: 'START',
};

// ãƒªãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼: stateã¨actionã‚’å—ã‘å–ã‚Šã€æ–°ã—ã„çŠ¶æ…‹ã‚’è¿”ã™çŠ¶æ…‹ç®¡ç†ã®ãŸã‚ã®é–¢æ•°ã€‚
// state: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
// action: çŠ¶æ…‹ã‚’ã©ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã‹ã‚’æŒ‡ç¤ºã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
const reducer = (state, action) => {
  switch (action.type) {
    case 'START':
      return {
        ...state,
        isStarted: true,
      };
    default:
      return state;
  }
};
//ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰åˆ©ç”¨ã™ã‚‹éš›ã€useContext ã‚’ä½¿ã£ã¦ã“ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
export const MyContext = createContext();

const MyContextProvider = ({ children }) => {
ã€€// çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã®é–¢æ•°ã¯ã€Providerã®ä¸­ã«æ›¸ã
  const [state, dispatch] = useReducer(reducer, initialState);
  const start = useCallback(() => dispatch(startAction), []);

  return (
    <MyContext.Provider value={{ ...state, start }}>
      {children}
    </MyContext.Provider>
  );
};

export default MyContextProvider;
```

```tsx:SomeComponent.js
// ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¾‹
const SomeComponent = () => {
  const { start, isStarted } = useContext(MyContext);

  return (
    <div>
      <button onClick={start}>Start</button>
      {isStarted && <p>Started!</p>}
    </div>
  );
};
```
