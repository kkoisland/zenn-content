---
title: "地図アプリのアーキテクチャをダイアグラムで整理する — API Key不要"
emoji: "🍓"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react", "openstreetmap", "leaflet", "アーキテクチャ", "地図"]
published: true
---

ひとつ前の「[AIを使った私の開発スタイル](https://zenn.dev/kkoisland/articles/f4f49b721f23b0)」という記事で、AIにコードを任せるからこそ設計が大切だと書きました。

設計をするためには自分自身がアーキテクチャをもっと明確に理解している必要があります。これまでは「コードが動いているからOK」で済ませてきましたが、実際にはアーキテクチャについては、そこまでクリアではありませんでした。

地図アプリを作るにあたって、そのアーキテクチャを整理したので、ダイアグラムを使って紹介します。

## OSM（OpenStreetMap）ベースの地図アーキテクチャの全体像

![OSMベースの地図アーキテクチャ](/images/map-architecture-043c648822dad3.png)

ダイアグラムは色で役割を分けています。

- **赤** — ユーザーが直接触れる部分: Map Display（地図表示）と Search Box（検索ボックス）
- **緑** — アプリケーション層: Web App と react-leaflet（ライブラリ）
- **青** — 外部サービス: OpenStreetMap（地図タイル提供）と Nominatim（ジオコーディング）

ジオコーディングとは、住所や地名などのテキストを緯度・経度の座標に変換する処理のこと。


### 地図タイルの取得 — react-leaflet

react-leaflet は Leaflet.js の React ラッパーで、React のコンポーネントとして地図を扱えます。地図のタイル（画像データ）は OpenStreetMap から URL ベースで取得しており、API Key は不要です。

### 検索のしくみ — Nominatim

Search Box に住所や地名を入力すると、Nominatim というジオコーディングサービスに問い合わせます。

Nominatim は OSM（OpenStreetMap） のデータをもとにテキストを座標に変換し、返ってきた座標で地図上にピンを立てます。Nominatim も利用規約を守れば無料で使えます。

## 他の地図サービスとの比較

同じ役割を持つ他の地図サービスと比較すると、それぞれの違いが見えてきます。このダイアグラムでは濃いピンクで示しています。

![他の地図サービスとの比較](/images/map-architecture2-043c648822dad3.png)

| | 地図表示 | ジオコーディング | API Key | 無料枠 |
|---|---|---|---|---|
| **OSM + react-leaflet** | OpenStreetMap タイル | Nominatim | 不要 | 制限なし（利用規約あり） |
| **Google Maps** | Google Maps JS API | Google Geocoding API | 必要 | 月$200分 |
| **Apple Maps** | MapKit JS | Apple Geocoder | 必要 | 1日25,000リクエスト |
| **Mapbox** | Mapbox GL JS | Mapbox Geocoding API | 必要 | 月50,000リクエスト |

Google Maps、Apple Maps、Mapbox はどれも高機能ですが、API Key の管理が必要です。個人開発やプロトタイプでは、OSM（OpenStreetMap） + react-leaflet の「API Key なし・無料」という手軽さが大きなメリットです。

OSM（OpenStreetMap） は API Key 不要で利用規約もシンプルなので手軽に始められますが、Nominatim にはリクエスト制限（1秒1リクエスト）があるため、本番環境での大規模利用では注意が必要です。

## Leaflet — キーウから生まれたオープンソース

react-leaflet の中核である Leaflet は、ウクライナ・キーウ在住の Volodymyr Agafonkin 氏が 2010 年に開発を始めたオープンソースライブラリです。GitHub では 44,500 以上のスターを獲得し、約 364,000 のプロジェクトで使われています。

現在もコミュニティによって開発が続いています。[GitHub のプロフィール](https://github.com/mourner)によると、Agafonkin 氏は Mapbox のエンジニアとして活動しながら、40 以上のオープンソースプロジェクトを維持しています。

2022 年のロシアによるウクライナ侵攻後もキーウに留まり、空襲警報の可視化ツールや停電の可視化プロジェクトを作成しているそうです。Leaflet プロジェクトへの寄付は [Open Collective](https://opencollective.com/leafletjs) を通じて行えます。

## ダイアグラムの活用

ダイアグラムを書いて、頭の中を整理すると、曖昧だった部分がはっきりします。今後はダイアグラムを多く取り入れた記事を書いていこうと考えています。
